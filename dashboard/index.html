<!DOCTYPE html>
<html>
<head>
    <title>Shadow-Walk Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; background: #121212; color: white; font-family: sans-serif; text-align: center; }
        #map { 
            height: 70vh; /* This makes the map visible! */
            width: 90%; 
            margin: 20px auto; 
            border-radius: 15px; 
            border: 2px solid #333;
        }
        .stats { display: flex; justify-content: center; gap: 20px; padding: 20px; }
        .box { background: #1e1e1e; padding: 15px; border-radius: 10px; min-width: 150px; border-bottom: 4px solid #00ff88; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è SHADOW-WALK COMMAND CENTER</h1>
    <div class="stats">
        <div class="box">System: üü¢ Online</div>
        <div class="box">Live Alerts: <span id="alert-count">0</span></div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
        // 1. Initialize Map
        const map = L.map('map').setView([12.9716, 77.5946], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // 2. Add Heatmap (Safe Zones)
        const heatData = [[12.9716, 77.5946, 0.9], [12.9720, 77.5950, 0.7], [12.9710, 77.5940, 0.8]];
        L.heatLayer(heatData, {radius: 25, blur: 15, gradient: {0.4: 'blue', 0.6: 'lime', 1: 'yellow'}}).addTo(map);

        // 3. Socket Connection
        const socket = io('http://localhost:3000');
        let count = 0;

        socket.on('new-shadow-alert', (data) => {
            count++;
            document.getElementById('alert-count').innerText = count;
            
            // Add Danger Marker
            const marker = L.circle([data.lat, data.lng], {
                color: 'red', fillColor: '#f03', fillOpacity: 0.5, radius: 100
            }).addTo(map);
            
            marker.bindPopup("<b>üö® EMERGENCY</b><br>Shadow reported here!").openPopup();
            map.flyTo([data.lat, data.lng], 16);
        });
    </script>
</body>
</html>