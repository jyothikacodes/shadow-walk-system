<!DOCTYPE html>
<html>

<head>
    <title>Shadow-Walk App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            background: #000;
            color: white;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        .safety-ring {
            width: 200px;
            height: 200px;
            border: 5px solid #00ff88;
            border-radius: 50%;
            margin: 40px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .status {
            color: #aaa;
        }

        button {
            padding: 15px 20px;
            font-size: 1rem;
            border-radius: 10px;
            border: none;
            margin: 10px;
            font-weight: bold;
        }

        .sos-btn {
            background: red;
            color: white;
        }

        /* Fake Call */
        #fake-call {
            display: none;
            position: fixed;
            inset: 0;
            background: #050505;
            z-index: 1000;
            padding-top: 120px;
        }

        .call-btn {
            width: 130px;
        }

        .accept {
            background: #00c853;
            color: white;
        }

        .reject {
            background: #d50000;
            color: white;
        }
    </style>
</head>

<body>

    <h1>SHADOW-WALK</h1>

    <div class="safety-ring" id="timer">02:00</div>
    <div class="status" id="gps">Finding GPS...</div>

    <button class="sos-btn" onclick="sendSOS()">ðŸš¨ DIRECT SOS</button>

    <!-- Fake Call Screen -->
    <div id="fake-call">
        <h1>ðŸ“ž Incoming Call</h1>
        <p>Emergency Contact</p>
        <button class="call-btn accept" onclick="attendCall()">Accept</button>
        <button class="call-btn reject" onclick="rejectCall()">Reject</button>
    </div>

    <script>
        let lat = null, lng = null, accuracy = null;
        let stationary = 0;

        const SAFE_CODE = "1234";
        const MAX_TIME = 120;

        const FIREBASE_URL =
            "https://project-d0293720-354a-4177-a34-default-rtdb.asia-southeast1.firebasedatabase.app/sos-alerts.json";

        // GPS
        navigator.geolocation.watchPosition(p => {
            lat = p.coords.latitude;
            lng = p.coords.longitude;
            accuracy = p.coords.accuracy;
            document.getElementById("gps").innerText =
                `ðŸ“ Active (Â±${Math.round(accuracy)}m)`;
        });

        // Timer
        setInterval(() => {
            if (lat == null) return;

            stationary++;

            const remaining = MAX_TIME - stationary;
            document.getElementById("timer").innerText =
                `0${Math.floor(remaining / 60)}:${remaining % 60 < 10 ? "0" : ""}${remaining % 60}`;

            if (remaining <= 0) {
                document.getElementById("fake-call").style.display = "block";
            }
        }, 1000);

        // Fake Call Actions
        function rejectCall() {
            sendSOS();
        }

        function attendCall() {
            const pin = prompt("Enter 4-digit safety PIN");
            if (pin === SAFE_CODE) {
                resetSystem();
                alert("âœ… Safety Confirmed");
            } else {
                sendSOS();
            }
        }

        function resetSystem() {
            stationary = 0;
            document.getElementById("fake-call").style.display = "none";
        }

        // SOS + Firebase
        async function sendSOS() {
            const payload = {
                lat,
                lng,
                accuracy,
                time: new Date().toISOString()
            };

            try {
                await fetch(FIREBASE_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                alert("ðŸš¨ SOS ALERT SENT");
            } catch (e) {
                alert("âŒ SOS FAILED");
            }
        }
    </script>

</body>
</html>
