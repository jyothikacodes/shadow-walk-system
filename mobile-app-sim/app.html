<!DOCTYPE html>
<html>
<head>
    <title>Shadow-Walk | GCP Secure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        .safety-ring { width: 180px; height: 180px; border: 4px solid #00ff88; border-radius: 50%; margin: 40px auto; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; }
        #fake-call-screen, #keypad-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; z-index: 2000; flex-direction: column; justify-content: space-around; align-items: center; }
        .call-btn { width: 75px; height: 75px; border-radius: 50%; border: none; font-size: 1.5rem; color: white; cursor: pointer; }
        .accept { background: #4cd964; } .decline { background: #ff3b30; }
        .key { width: 80px; height: 80px; border: 1px solid #444; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .keypad-grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 20px; }
    </style>
</head>
<body>
    <h2>SHADOW-WALK</h2>
    <div class="safety-ring" id="timer-display">02:00</div>
    <p id="gps-status">Finding GPS...</p>
    <button onclick="stationarySeconds = 118" style="opacity: 0.2;">Test</button>

    <div id="fake-call-screen">
        <div style="font-size: 2rem;">Home<br><span style="font-size: 1rem; color: #00ff88;">Incoming...</span></div>
        <div style="display: flex; gap: 50px;">
            <button class="call-btn decline" onclick="triggerSOS('Call Rejected')">âœ–</button>
            <button class="call-btn accept" onclick="showKeypad()">ðŸ“ž</button>
        </div>
    </div>

    <div id="keypad-screen">
        <h3>Enter Security PIN</h3>
        <div id="code-display" style="font-size: 2rem; letter-spacing: 10px;">----</div>
        <div class="keypad-grid" id="keys"></div>
    </div>

    <script>
        let lat, lng, lastLat, lastLng, stationarySeconds = 0;
        let currentInput = "";
        const SAFE_CODE = "1234", MAX_TIME = 120;

        navigator.geolocation.watchPosition(p => {
            lat = p.coords.latitude; lng = p.coords.longitude;
            document.getElementById('gps-status').innerText = "ðŸ“ Tracking Active";
            if(!lastLat) { lastLat = lat; lastLng = lng; }
        });

        setInterval(() => {
            if(!lat) return;
            // Check for stationary status
            if(lat === lastLat && lng === lastLng) stationarySeconds++;
            else { stationarySeconds = 0; lastLat = lat; lastLng = lng; }

            const remaining = MAX_TIME - stationarySeconds;
            if(remaining <= 0) document.getElementById('fake-call-screen').style.display = 'flex';
            else updateTimer(remaining);
        }, 1000);

        function updateTimer(s) {
            const m = Math.floor(s/60); const sec = s%60;
            document.getElementById('timer-display').innerText = `${m}:${sec < 10 ? '0'+sec : sec}`;
        }

        function showKeypad() {
            document.getElementById('fake-call-screen').style.display = 'none';
            document.getElementById('keypad-screen').style.display = 'flex';
            const grid = document.getElementById('keys'); grid.innerHTML = '';
            [1,2,3,4,5,6,7,8,9,0].forEach(n => {
                const div = document.createElement('div'); div.className = 'key'; div.innerText = n;
                div.onclick = () => {
                    currentInput += n;
                    document.getElementById('code-display').innerText = "*".repeat(currentInput.length).padEnd(4, "-");
                    if(currentInput.length === 4) {
                        if(currentInput === SAFE_CODE) location.reload();
                        else triggerSOS("Incorrect PIN");
                    }
                };
                grid.appendChild(div);
            });
        }

        async function triggerSOS(reason) {
            const payload = { lat, lng, type: "SOS", reason, platform: "Google Cloud Function" };
            try {
                await fetch('http://localhost:3000/report-shadow', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
            } catch(e) {}
            alert("ðŸš¨ EMERGENCY BROADCASTED TO GCP DISPATCH");
            location.reload();
        }
    </script>
</body>
</html> 

